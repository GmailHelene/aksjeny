{% extends "base.html" %}

{% block title %}Aksje Screener | Aksjeradar{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-9">
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h2><i class="bi bi-funnel"></i> Aksje Screener</h2>
                    <p class="mb-0">Finn aksjer basert på dine investeringskriterier</p>
                </div>
                <div class="card-body">
                    <!-- Screening Form -->
                    <form method="POST" action="{{ url_for('analysis.screener') }}" class="mb-4">
                        {{ csrf_token() }}
                        <div class="row">
                            <div class="col-md-3">
                                <label for="min_market_cap" class="form-label">Min. markedsverdi (NOK)</label>
                                <select name="min_market_cap" class="form-select">
                                    <option value="0">Alle størrelser</option>
                                    <option value="1000000000">1 milliard+</option>
                                    <option value="10000000000">10 milliarder+</option>
                                    <option value="100000000000">100 milliarder+</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="max_pe_ratio" class="form-label">Maks P/E ratio</label>
                                <select name="max_pe_ratio" class="form-select">
                                    <option value="50">Alle</option>
                                    <option value="10">Under 10</option>
                                    <option value="15">Under 15</option>
                                    <option value="20">Under 20</option>
                                    <option value="25">Under 25</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="min_dividend_yield" class="form-label">Min. utbytteavkastning (%)</label>
                                <select name="min_dividend_yield" class="form-select">
                                    <option value="0">Alle</option>
                                    <option value="2">2%+</option>
                                    <option value="4">4%+</option>
                                    <option value="6">6%+</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="sector" class="form-label">Sektor</label>
                                <select name="sector" class="form-select">
                                    <option value="all">Alle sektorer</option>
                                    <option value="Energy">Energi</option>
                                    <option value="Financial">Finans</option>
                                    <option value="Technology">Teknologi</option>
                                    <option value="Healthcare">Helse</option>
                                    <option value="Materials">Råvarer</option>
                                    <option value="Consumer">Forbruker</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-search"></i> Filtrer aksjer
                                </button>
                                <button type="reset" class="btn btn-outline-secondary ms-2">
                                    <i class="bi bi-arrow-counterclockwise"></i> Nullstill
                                </button>
                            </div>
                        </div>
                    </form>

                    {% if results %}
                    <!-- Results Table -->
                    <div class="table-responsive">
                        <h4>Screeningresultater ({{ results|length }} aksjer funnet)</h4>
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Ticker</th>
                                    <th>Selskap</th>
                                    <th>Sektor</th>
                                    <th>Pris</th>
                                    <th>Endring</th>
                                    <th>Markedsverdi</th>
                                    <th>P/E</th>
                                    <th>Utbytte</th>
                                    <th>Handling</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stock in results %}
                                <tr>
                                    <td><strong>{{ stock.ticker }}</strong></td>
                                    <td>{{ stock.name }}</td>
                                    <td>
                                        <span class="badge bg-secondary">{{ stock.sector }}</span>
                                    </td>
                                    <td>{{ "%.2f"|format(stock.price) }} NOK</td>
                                    <td>
                                        <span class="{% if stock.change_percent > 0 %}text-success{% elif stock.change_percent < 0 %}text-danger{% else %}text-muted{% endif %}">
                                            {{ "%.2f"|format(stock.change_percent) }}%
                                        </span>
                                    </td>
                                    <td>{{ "%.1f"|format(stock.market_cap / 1000000000) }} mrd</td>
                                    <td>{{ "%.1f"|format(stock.pe_ratio) }}</td>
                                    <td>{{ "%.1f"|format(stock.dividend_yield) }}%</td>
                                    <td>
                                        <a href="{{ url_for('stocks.details', ticker=stock.ticker) }}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i> Detaljer
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Criteria Summary -->
                    <div class="mt-4">
                        <h5>Anvendte kriterier:</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Min. markedsverdi:</strong><br>
                                {{ "%.0f"|format(criteria.min_market_cap|float / 1000000000) if criteria.min_market_cap|float > 0 else "Alle" }} 
                                {% if criteria.min_market_cap|float > 0 %}mrd NOK{% endif %}
                            </div>
                            <div class="col-md-3">
                                <strong>Maks P/E:</strong><br>
                                {{ criteria.max_pe_ratio }}
                            </div>
                            <div class="col-md-3">
                                <strong>Min. utbytte:</strong><br>
                                {{ criteria.min_dividend_yield }}%
                            </div>
                            <div class="col-md-3">
                                <strong>Sektor:</strong><br>
                                {{ "Alle sektorer" if criteria.sector == "all" else criteria.sector }}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- No Results / Initial State -->
                    <div class="text-center py-5">
                        <i class="bi bi-funnel display-1 text-muted"></i>
                        <h4 class="mt-3">Bruk screeneren for å finne aksjer</h4>
                        <p class="text-muted">Sett dine kriterier ovenfor og klikk "Filtrer aksjer" for å se resultater</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-3">
            <div class="card mb-3">
                <div class="card-header">
                    <h5>Populære screener-kriterier</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6>Verdiaksjer</h6>
                        <small class="text-muted">Lav P/E, høyt utbytte</small>
                    </div>
                    <div class="mb-3">
                        <h6>Vekstaksjer</h6>
                        <small class="text-muted">Høy omsetningsvekst, lav utbytte</small>
                    </div>
                    <div class="mb-3">
                        <h6>Utbytteaksjer</h6>
                        <small class="text-muted">Høy og stabil utbytteavkastning</small>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>Andre analysetyper</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('analysis.warren_buffett') }}" class="btn btn-outline-primary btn-sm">
                            Warren Buffett Analyse
                        </a>
                        <a href="{{ url_for('analysis.benjamin_graham') }}" class="btn btn-outline-success btn-sm">
                            Benjamin Graham Analyse
                        </a>
                        <a href="{{ url_for('analysis.sentiment') }}" class="btn btn-outline-info btn-sm">
                            Sentiment Analyse
                        </a>
                        <a href="{{ url_for('analysis.technical') }}" class="btn btn-outline-warning btn-sm">
                            Teknisk Analyse
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
