{% extends "base.html" %}

{% block title %}Warren Buffett Analyse | Aksjeradar{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-9">
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h2 class="mb-0">
                        <i class="bi bi-graph-up text-success me-2"></i>
                        Warren Buffett Analyse
                        {% if stock_data %}
                        - {{ stock_data.ticker }}
                        {% endif %}
                    </h2>
                </div>
                <div class="card-body">
                    <!-- Stock Selection Form -->
                    <form method="POST" action="{{ url_for('analysis.warren_buffett') }}" class="mb-4">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="row">
                            <div class="col-md-8">
                                <label for="ticker" class="form-label">Velg aksje for Buffett-analyse:</label>
                                <select name="ticker" id="ticker" class="form-select" required>
                                    <option value="">-- Velg aksje --</option>
                                    <optgroup label="Oslo Børs">
                                        <option value="EQNR.OL" {% if stock_data and stock_data.ticker == 'EQNR.OL' %}selected{% endif %}>Equinor (EQNR.OL)</option>
                                        <option value="DNB.OL" {% if stock_data and stock_data.ticker == 'DNB.OL' %}selected{% endif %}>DNB (DNB.OL)</option>
                                        <option value="TEL.OL" {% if stock_data and stock_data.ticker == 'TEL.OL' %}selected{% endif %}>Telenor (TEL.OL)</option>
                                        <option value="YAR.OL" {% if stock_data and stock_data.ticker == 'YAR.OL' %}selected{% endif %}>Yara (YAR.OL)</option>
                                        <option value="MOWI.OL" {% if stock_data and stock_data.ticker == 'MOWI.OL' %}selected{% endif %}>Mowi (MOWI.OL)</option>
                                    </optgroup>
                                    <optgroup label="US Aksjer">
                                        <option value="AAPL" {% if stock_data and stock_data.ticker == 'AAPL' %}selected{% endif %}>Apple (AAPL)</option>
                                        <option value="MSFT" {% if stock_data and stock_data.ticker == 'MSFT' %}selected{% endif %}>Microsoft (MSFT)</option>
                                        <option value="GOOGL" {% if stock_data and stock_data.ticker == 'GOOGL' %}selected{% endif %}>Alphabet (GOOGL)</option>
                                        <option value="BRK-B" {% if stock_data and stock_data.ticker == 'BRK-B' %}selected{% endif %}>Berkshire Hathaway (BRK-B)</option>
                                        <option value="KO" {% if stock_data and stock_data.ticker == 'KO' %}selected{% endif %}>Coca-Cola (KO)</option>
                                        <option value="PG" {% if stock_data and stock_data.ticker == 'PG' %}selected{% endif %}>Procter & Gamble (PG)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">&nbsp;</label>
                                <button type="submit" class="btn btn-primary d-block w-100">
                                    <i class="bi bi-search"></i> Analyser
                                </button>
                            </div>
                        </div>
                    </form>

                    {% if stock_data %}
                    <!-- Analysis Results -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="alert alert-info">
                                <h5><i class="bi bi-info-circle me-2"></i>Warren Buffett Investeringsprinsipper</h5>
                                <p class="mb-0">Denne analysen evaluerer aksjen basert på Warren Buffetts investeringsfilosofi: sterke fundamentals, konkurransefortrinn, konsistent vekst og rimelig verdsettelse.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center border-primary">
                                <div class="card-body">
                                    <h6 class="text-primary">P/E Ratio</h6>
                                    <h4>{{ "%.1f"|format(stock_data.pe_ratio) if stock_data.pe_ratio else 'N/A' }}</h4>
                                    <small class="text-muted">
                                        {% if stock_data.pe_ratio %}
                                            {% if stock_data.pe_ratio < 15 %}
                                                <span class="text-success">Attraktiv</span>
                                            {% elif stock_data.pe_ratio < 25 %}
                                                <span class="text-warning">Moderat</span>
                                            {% else %}
                                                <span class="text-danger">Høy</span>
                                            {% endif %}
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-success">
                                <div class="card-body">
                                    <h6 class="text-success">ROE (%)</h6>
                                    <h4>{{ "%.1f"|format(stock_data.roe * 100) if stock_data.roe else 'N/A' }}</h4>
                                    <small class="text-muted">
                                        {% if stock_data.roe %}
                                            {% if stock_data.roe > 0.15 %}
                                                <span class="text-success">Excellent</span>
                                            {% elif stock_data.roe > 0.10 %}
                                                <span class="text-warning">God</span>
                                            {% else %}
                                                <span class="text-danger">Svak</span>
                                            {% endif %}
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-info">
                                <div class="card-body">
                                    <h6 class="text-info">Utbytte (%)</h6>
                                    <h4>{{ "%.1f"|format(stock_data.dividend_yield * 100) if stock_data.dividend_yield else 'N/A' }}</h4>
                                    <small class="text-muted">
                                        {% if stock_data.dividend_yield %}
                                            {% if stock_data.dividend_yield > 0.03 %}
                                                <span class="text-success">Attraktiv</span>
                                            {% elif stock_data.dividend_yield > 0.01 %}
                                                <span class="text-warning">Moderat</span>
                                            {% else %}
                                                <span class="text-danger">Lav</span>
                                            {% endif %}
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center border-warning">
                                <div class="card-body">
                                    <h6 class="text-warning">Buffett Score</h6>
                                    <h4>{{ stock_data.buffett_score if stock_data.buffett_score else 'N/A' }}/10</h4>
                                    <small class="text-muted">
                                        {% if stock_data.buffett_score %}
                                            {% if stock_data.buffett_score >= 8 %}
                                                <span class="text-success">Excellent</span>
                                            {% elif stock_data.buffett_score >= 6 %}
                                                <span class="text-warning">God</span>
                                            {% else %}
                                                <span class="text-danger">Svak</span>
                                            {% endif %}
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Analysis -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5><i class="bi bi-shield-check text-success me-2"></i>Finansiell Styrke</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <strong>Egenkapitalandel:</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.debt_to_equity * 100) if stock_data.debt_to_equity else 'N/A' }}%</span>
                                        </li>
                                        <li class="mb-2">
                                            <strong>Rentedekningsgrad:</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.interest_coverage) if stock_data.interest_coverage else 'N/A' }}x</span>
                                        </li>
                                        <li class="mb-2">
                                            <strong>Current Ratio:</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.current_ratio) if stock_data.current_ratio else 'N/A' }}</span>
                                        </li>
                                        <li class="mb-2">
                                            <strong>Book Value per Share:</strong> 
                                            <span class="float-end">${{ "%.2f"|format(stock_data.book_value_per_share) if stock_data.book_value_per_share else 'N/A' }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5><i class="bi bi-graph-up text-primary me-2"></i>Vekst & Lønnsomhet</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <strong>Inntektsvekst (5 år):</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.revenue_growth_5y * 100) if stock_data.revenue_growth_5y else 'N/A' }}%</span>
                                        </li>
                                        <li class="mb-2">
                                            <strong>EPS Vekst (5 år):</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.eps_growth_5y * 100) if stock_data.eps_growth_5y else 'N/A' }}%</span>
                                        </li>
                                        <li class="mb-2">
                                            <strong>Profit Margin:</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.profit_margin * 100) if stock_data.profit_margin else 'N/A' }}%</span>
                                        </li>
                                        <li class="mb-2">
                                            <strong>Operating Margin:</strong> 
                                            <span class="float-end">{{ "%.1f"|format(stock_data.operating_margin * 100) if stock_data.operating_margin else 'N/A' }}%</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Buffett Analysis Recommendations -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-lightbulb text-warning me-2"></i>Buffett Analyse Konklusjon</h5>
                        </div>
                        <div class="card-body">
                            {% if stock_data.analysis_summary %}
                            <p>{{ stock_data.analysis_summary }}</p>
                            {% else %}
                            <div class="alert alert-info">
                                <h6>Basert på Warren Buffetts investeringsprinsipper:</h6>
                                <ul class="mb-0">
                                    <li><strong>Forretningsforståelse:</strong> Investér kun i selskaper du forstår</li>
                                    <li><strong>Konkurransefortrinn:</strong> Selskaper med sterke "moats" (økonomiske vollgraver)</li>
                                    <li><strong>Ledelseskvalitet:</strong> Kompetent og pålitelig ledelse</li>
                                    <li><strong>Rimelig pris:</strong> Kjøp når prisen er under egenverdi</li>
                                    <li><strong>Langsiktig perspektiv:</strong> Hold investering i mange år</li>
                                </ul>
                            </div>
                            {% endif %}
                            
                            {% if stock_data.buffett_score %}
                            <div class="mt-3">
                                {% if stock_data.buffett_score >= 8 %}
                                <div class="alert alert-success">
                                    <strong><i class="bi bi-check-circle me-2"></i>Anbefaling: KJØP</strong><br>
                                    Denne aksjen scorer høyt på Buffetts kriterier og kan være en god langsiktig investering.
                                </div>
                                {% elif stock_data.buffett_score >= 6 %}
                                <div class="alert alert-warning">
                                    <strong><i class="bi bi-exclamation-circle me-2"></i>Anbefaling: VURDER</strong><br>
                                    Aksjen har noen gode kvaliteter, men vurder risikoer og timing nøye.
                                </div>
                                {% else %}
                                <div class="alert alert-danger">
                                    <strong><i class="bi bi-x-circle me-2"></i>Anbefaling: UNNGÅ</strong><br>
                                    Aksjen oppfyller ikke Buffetts hovedkriterier for investering.
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-search display-1 text-muted"></i>
                        <h4 class="text-muted mt-3">Velg en aksje for Warren Buffett analyse</h4>
                        <p class="text-muted">Analyser aksjer basert på Warren Buffetts investeringsprinsipper</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    <h6><i class="bi bi-info-circle me-2"></i>Om Warren Buffett Analyse</h6>
                </div>
                <div class="card-body">
                    <p class="small">Warren Buffett, "Oracle of Omaha", er en av verdens mest suksessrike investorer. Hans tilnærming fokuserer på:</p>
                    <ul class="small">
                        <li>Verdikjøp av kvalitetsselskaper</li>
                        <li>Langsiktig investeringsperspektiv</li>
                        <li>Sterke konkurransefortrinn</li>
                        <li>Konsistent lønnsomhet</li>
                        <li>Kompetent ledelse</li>
                    </ul>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h6><i class="bi bi-graph-up me-2"></i>Relaterte Analyser</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('analysis.benjamin_graham') }}" class="btn btn-outline-primary btn-sm">
                            Benjamin Graham Analyse
                        </a>
                        <a href="{{ url_for('analysis.technical') }}" class="btn btn-outline-success btn-sm">
                            Teknisk Analyse
                        </a>
                        <a href="{{ url_for('analysis.recommendation') }}" class="btn btn-outline-info btn-sm">
                            Anbefalinger
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhance ticker selection
    const tickerSelect = document.getElementById('ticker');
    if (tickerSelect) {
        tickerSelect.addEventListener('change', function() {
            // Could add real-time preview here
        });
    }
});
</script>
{% endblock %}