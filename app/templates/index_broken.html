{% extends "base.html" %}

{% block title %}Hjem - Aksjeradar{% endblock %}

{% block content %}
{% if current_user.is_authenticated %}
    <!-- Dashboard for Premium/Logged in users -->
    <div class="container-fluid mt-4 dashboard-container">
        <!-- Welcome Header with Enhanced Mobile Design -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="welcome-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        <div class="welcome-content mb-3 mb-md-0">
                            <h1 class="display-6 mb-2">Velkommen tilbake!</h1>
                            <p class="text-muted mb-0">Oversikt over markedet akkurat nå</p>
                        </div>
                        <div class="premium-badge">
                            <span class="badge bg-gradient-success px-3 py-2 rounded-pill">
                                <i class="bi bi-star-fill me-1"></i>Premium Tilgang
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats Cards for Mobile -->
        <div class="row mb-4 d-block d-md-none">
            <div class="col-12">
                <div class="quick-stats-mobile">
                    <div class="stats-scroll d-flex overflow-auto pb-2">
                        <div class="stat-card-mini me-3 flex-shrink-0">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center p-3">
                                    <i class="bi bi-graph-up text-success fs-4"></i>
                                    <div class="mt-1">
                                        <small class="text-muted d-block">OSEBX</small>
                                        <strong class="text-success">+1.2%</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card-mini me-3 flex-shrink-0">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center p-3">
                                    <i class="bi bi-currency-dollar text-primary fs-4"></i>
                                    <div class="mt-1">
                                        <small class="text-muted d-block">USD/NOK</small>
                                        <strong>10.45</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card-mini me-3 flex-shrink-0">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center p-3">
                                    <i class="bi bi-currency-bitcoin text-warning fs-4"></i>
                                    <div class="mt-1">
                                        <small class="text-muted d-block">BTC</small>
                                        <strong class="text-success">+2.4%</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Market Overview Tables for Premium Users -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="d-none d-md-block">Markedsdata <span class="badge bg-success">Premium Tilgang</span></h2>
                <h3 class="d-block d-md-none mb-3">Markedsdata</h3>
                <p class="text-muted d-none d-md-block">Sanntids markedsdata og analyser</p>
            </div>
        </div>
        
        <!-- Oslo Børs Table with Enhanced Mobile Design -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-gradient-primary text-white border-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="bi bi-bar-chart me-2"></i>
                                <span class="d-none d-md-inline">Oslo Børs - Topp Aksjer</span>
                                <span class="d-inline d-md-none">Oslo Børs</span>
                            </h5>
                            <small class="opacity-75 d-none d-md-inline">Sanntidsdata</small>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Desktop Table -->
                        <div class="table-responsive d-none d-lg-block">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="border-0 fw-semibold">Symbol</th>
                                        <th class="border-0 fw-semibold">Navn</th>
                                        <th class="border-0 fw-semibold">Pris</th>
                                        <th class="border-0 fw-semibold">Endring</th>
                                        <th class="border-0 fw-semibold">Endring %</th>
                                        <th class="border-0 fw-semibold">Volum</th>
                                        <th class="border-0 fw-semibold">Handlinger</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="align-middle">
                                        <td><strong class="text-primary">EQNR.OL</strong></td>
                                        <td>Equinor ASA</td>
                                        <td><strong>278.50 NOK</strong></td>
                                        <td class="text-success fw-semibold">+3.25</td>
                                        <td class="text-success fw-semibold">+1.18%</td>
                                        <td class="text-muted">2,450,123</td>
                                        <td>
                                            <a href="{{ url_for('stocks.details', symbol='EQNR.OL') }}" class="btn btn-sm btn-outline-primary rounded-pill">
                                                <i class="bi bi-eye me-1"></i>Detaljer
                                            </a>
                                        </td>
                                    </tr>
                                    <tr class="align-middle">
                                        <td><strong class="text-danger">DNB.OL</strong></td>
                                        <td>DNB Bank ASA</td>
                                        <td><strong>195.80 NOK</strong></td>
                                        <td class="text-danger fw-semibold">-1.20</td>
                                        <td class="text-danger fw-semibold">-0.61%</td>
                                        <td class="text-muted">1,234,567</td>
                                        <td>
                                            <a href="{{ url_for('stocks.details', symbol='DNB.OL') }}" class="btn btn-sm btn-outline-primary rounded-pill">
                                                <i class="bi bi-eye me-1"></i>Detaljer
                                            </a>
                                        </td>
                                    </tr>
                                    <tr class="align-middle">
                                        <td><strong class="text-success">NHY.OL</strong></td>
                                        <td>Norsk Hydro ASA</td>
                                        <td><strong>65.40 NOK</strong></td>
                                        <td class="text-success fw-semibold">+0.85</td>
                                        <td class="text-success fw-semibold">+1.32%</td>
                                        <td class="text-muted">3,456,789</td>
                                        <td>
                                            <a href="{{ url_for('stocks.details', symbol='NHY.OL') }}" class="btn btn-sm btn-outline-primary rounded-pill">
                                                <i class="bi bi-eye me-1"></i>Detaljer
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Mobile Card Layout -->
                        <div class="d-block d-lg-none">
                            <div class="mobile-stocks-container p-3">
                                <div class="stock-card mb-3 p-3 bg-light rounded-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="mb-1 text-primary fw-bold">EQNR.OL</h6>
                                            <small class="text-muted">Equinor ASA</small>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold">278.50 NOK</div>
                                            <small class="text-success">+3.25 (+1.18%)</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">Vol: 2.45M</small>
                                        <a href="{{ url_for('stocks.details', symbol='EQNR.OL') }}" class="btn btn-sm btn-primary rounded-pill">
                                            <i class="bi bi-eye me-1"></i>Se
                                        </a>
                                    </div>
                                </div>
                                
                                <div class="stock-card mb-3 p-3 bg-light rounded-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="mb-1 text-danger fw-bold">DNB.OL</h6>
                                            <small class="text-muted">DNB Bank ASA</small>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold">195.80 NOK</div>
                                            <small class="text-danger">-1.20 (-0.61%)</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">Vol: 1.23M</small>
                                        <a href="{{ url_for('stocks.details', symbol='DNB.OL') }}" class="btn btn-sm btn-primary rounded-pill">
                                            <i class="bi bi-eye me-1"></i>Se
                                        </a>
                                    </div>
                                </div>
                                
                                <div class="stock-card mb-3 p-3 bg-light rounded-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="mb-1 text-success fw-bold">NHY.OL</h6>
                                            <small class="text-muted">Norsk Hydro ASA</small>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold">65.40 NOK</div>
                                            <small class="text-success">+0.85 (+1.32%)</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">Vol: 3.46M</small>
                                        <a href="{{ url_for('stocks.details', symbol='NHY.OL') }}" class="btn btn-sm btn-primary rounded-pill">
                                            <i class="bi bi-eye me-1"></i>Se
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-footer bg-light border-0">
                            <div class="text-center">
                                <a href="{{ url_for('stocks.list', market='oslo') }}" class="btn btn-primary rounded-pill px-4">
                                    <i class="bi bi-arrow-right me-2"></i>Se alle Oslo Børs aksjer
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Markets Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-globe"></i> Globale Aksjer</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Navn</th>
                                        <th>Pris</th>
                                        <th>Endring</th>
                                        <th>Endring %</th>
                                        <th>Handlinger</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>AAPL</strong></td>
                                        <td>Apple Inc.</td>
                                        <td>$175.23</td>
                                        <td class="text-success">+2.15</td>
                                        <td class="text-success">+1.24%</td>
                                        <td>
                                            <a href="{{ url_for('stocks.details', symbol='AAPL') }}" class="btn btn-sm btn-outline-primary">Detaljer</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>MSFT</strong></td>
                                        <td>Microsoft Corporation</td>
                                        <td>$340.67</td>
                                        <td class="text-danger">-3.45</td>
                                        <td class="text-danger">-1.00%</td>
                                        <td>
                                            <a href="{{ url_for('stocks.details', symbol='MSFT') }}" class="btn btn-sm btn-outline-primary">Detaljer</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>TSLA</strong></td>
                                        <td>Tesla Inc.</td>
                                        <td>$245.89</td>
                                        <td class="text-success">+5.67</td>
                                        <td class="text-success">+2.36%</td>
                                        <td>
                                            <a href="{{ url_for('stocks.details', symbol='TSLA') }}" class="btn btn-sm btn-outline-primary">Detaljer</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-end">
                            <a href="{{ url_for('stocks.list', market='global') }}" class="btn btn-success">Se alle globale aksjer</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crypto and Currency Row -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-currency-bitcoin"></i> Kryptovaluta</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Pris</th>
                                        <th>Endring %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>BTC</strong></td>
                                        <td>$43,567</td>
                                        <td class="text-success">+2.45%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ETH</strong></td>
                                        <td>$2,567</td>
                                        <td class="text-danger">-1.23%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>BNB</strong></td>
                                        <td>$345</td>
                                        <td class="text-success">+0.89%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-end">
                            <a href="{{ url_for('stocks.list', market='crypto') }}" class="btn btn-warning">Se alle krypto</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-currency-exchange"></i> Valutakurser</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Valuta</th>
                                        <th>Kurs</th>
                                        <th>Endring %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>USD/NOK</strong></td>
                                        <td>10.45</td>
                                        <td class="text-success">+0.32%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>EUR/NOK</strong></td>
                                        <td>11.67</td>
                                        <td class="text-danger">-0.15%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>GBP/NOK</strong></td>
                                        <td>13.25</td>
                                        <td class="text-success">+0.78%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-end">
                            <a href="{{ url_for('stocks.list', market='currency') }}" class="btn btn-info">Se alle valutaer</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-lightning"></i> Hurtigtilgang</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <a href="{{ url_for('analysis.index') }}" class="btn btn-outline-primary w-100">
                                    <i class="bi bi-graph-up"></i> Analyser
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="{{ url_for('portfolio.index') }}" class="btn btn-outline-success w-100">
                                    <i class="bi bi-briefcase"></i> Portefølje
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="{{ url_for('news_bp.index') }}" class="btn btn-outline-info w-100">
                                    <i class="bi bi-newspaper"></i> Nyheter
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="{{ url_for('stocks.search') }}" class="btn btn-outline-secondary w-100">
                                    <i class="bi bi-search"></i> Søk aksjer
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% else %}
        <!-- Landing page for non-logged in users -->
        <div class="text-center py-5">
            <h1 class="display-4">Velkommen til Aksjeradar</h1>
            <p class="lead">Norges smarteste plattform for aksjeanalyse</p>
            
            <div class="row mt-5">
                <div class="col-md-4">
                    <i class="bi bi-robot display-3 text-primary"></i>
                    <h3>AI-drevet analyse</h3>
                    <p>Få innsikt fra avanserte algoritmer</p>
                </div>
                <div class="col-md-4">
                    <i class="bi bi-graph-up-arrow display-3 text-success"></i>
                    <h3>Sanntidsdata</h3>
                    <p>Oppdaterte kurser og nyheter</p>
                </div>
                <div class="col-md-4">
                    <i class="bi bi-shield-check display-3 text-info"></i>
                    <h3>Sikker og pålitelig</h3>
                    <p>Dine data er trygge hos oss</p>
                </div>
            </div>
            
            <div class="mt-5">
                <a href="{{ url_for('main.demo') }}" class="btn btn-success btn-lg me-3">
                    <i class="bi bi-play-circle"></i> Prøv demo
                </a>
                <a href="{{ url_for('main.register') }}" class="btn btn-primary btn-lg">
                    <i class="bi bi-person-plus"></i> Kom i gang
                </a>
            </div>
        </div>
    {% endif %}
</div>

<!-- Hero Section for non-authenticated users -->
{% if not current_user.is_authenticated %}
            </div>
            <div class="col-lg-6">
                <div class="hero-image position-relative">
                    <div class="dashboard-frame shadow-lg">
                        <img src="{{ url_for('static', filename='img/dashboard-preview.png') }}" 
                             alt="Aksjeradar Dashboard Preview - AI-drevet aksjeanalyse" 
                             class="img-fluid rounded-3 border border-light"
                             style="max-width: 100%; height: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
                    </div>
                    <!-- Floating elements for visual appeal -->
                    <div class="floating-badge badge bg-success position-absolute top-0 end-0 m-3 px-3 py-2">
                        <i class="fas fa-chart-line me-1"></i>Live Data
                    </div>
                    <div class="floating-badge badge bg-primary position-absolute bottom-0 start-0 m-3 px-3 py-2">
                        <i class="fas fa-brain me-1"></i>AI-Powered
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if current_user.is_authenticated %}
<!-- Premium User Market Tables (like previous versions) -->
<div class="premium-market-overview py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <h2>Markedsdata - Premium Tilgang</h2>
                <p class="text-muted">Sanntids markedsdata og analyser</p>
            </div>
        </div>
        
        <!-- Oslo Børs Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Oslo Børs - Topp Aksjer</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Aksje</th>
                                        <th>Pris (NOK)</th>
                                        <th>Endring</th>
                                        <th>Endring %</th>
                                        <th>Volum</th>
                                    </tr>
                                </thead>
                                <tbody id="oslo-stocks">
                                    <!-- Market data will be loaded here -->
                                    <tr><td colspan="5" class="text-center">Laster markedsdata...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="{{ url_for('stocks.list_oslo') }}" class="btn btn-primary">Se alle Oslo Børs aksjer</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Global Stocks Table -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-globe"></i> Globale Aksjer</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Aksje</th>
                                        <th>Pris</th>
                                        <th>Endring %</th>
                                    </tr>
                                </thead>
                                <tbody id="global-stocks">
                                    <tr><td colspan="3" class="text-center">Laster data...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="{{ url_for('stocks.global_list') }}" class="btn btn-success">Se globale aksjer</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Crypto Table -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-currency-bitcoin"></i> Kryptovaluta</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Valuta</th>
                                        <th>Pris (USD)</th>
                                        <th>Endring %</th>
                                    </tr>
                                </thead>
                                <tbody id="crypto-data">
                                    <tr><td colspan="3" class="text-center">Laster krypto data...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="{{ url_for('stocks.list_crypto') }}" class="btn btn-warning">Se kryptovaluta</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Demo Market Overview for Guests -->
<div class="market-overview py-5">
    <div class="container">
        <h2 class="text-center mb-5">Markedsoversikt</h2>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="market-card">
                    <h5>Oslo Børs (OSEBX)</h5>
                    <div class="market-data">
                        <span class="price">{{ osebx_price|default('1,234.56') }}</span>
                        <span class="change positive">+1.2%</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="market-card">
                    <h5>Topp gainer</h5>
                    <div class="market-data">
                        <span class="stock-name">{{ top_gainer_name|default('EQUI') }}</span>
                        <span class="change positive">+{{ top_gainer_change|default('15.3') }}%</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="market-card">
                    <h5>Høyest volum</h5>
                    <div class="market-data">
                        <span class="stock-name">{{ top_volume_name|default('DNB') }}</span>
                        <span class="volume">{{ top_volume|default('2.5M') }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if not current_user.is_authenticated %}
<div id="demo" class="features-section py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">Kraftige analyseverktøy</h2>
        <div class="row">
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h5>Teknisk analyse</h5>
                    <p>Avanserte tekniske indikatorer og chartverktøy for profesjonell analyse.</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h5>Fundamental analyse</h5>
                    <p>Dype fundamental analyser av selskaper med nøkkeltall og prognoser.</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <h5>Sanntidsvarsler</h5>
                    <p>Få varsler om viktige markedsbevegelser og handelsmuligheter.</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <h5>Overvåkningslister</h5>
                    <p>Opprett og administrer dine egne overvåkningslister med favorittaksjer.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Premium User Market Tables -->
<div class="premium-market-overview py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <h2>Markedsdetaljer</h2>
                <p class="text-muted">Sanntids markedsdata og analyser</p>
            </div>
        </div>
        
        <!-- Oslo Børs Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Oslo Børs - Topp Aksjer</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Aksje</th>
                                        <th>Pris (NOK)</th>
                                        <th>Endring</th>
                                        <th>Endring %</th>
                                        <th>Volum</th>
                                    </tr>
                                </thead>
                                <tbody id="oslo-stocks">
                                    <!-- Market data will be loaded here -->
                                    <tr><td colspan="5" class="text-center">Laster markedsdata...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="{{ url_for('stocks.list_oslo') }}" class="btn btn-primary">Se alle Oslo Børs aksjer</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Global Stocks Table -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-globe"></i> Globale Aksjer</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Aksje</th>
                                        <th>Pris</th>
                                        <th>Endring</th>
                                    </tr>
                                </thead>
                                <tbody id="global-stocks">
                                    <tr><td colspan="3" class="text-center">Laster...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="{{ url_for('stocks.global_list') }}" class="btn btn-success btn-sm">Se alle globale aksjer</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Crypto Table -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-currency-bitcoin"></i> Kryptovaluta</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Mynt</th>
                                        <th>Pris</th>
                                        <th>Endring</th>
                                    </tr>
                                </thead>
                                <tbody id="crypto-data">
                                    <tr><td colspan="3" class="text-center">Laster...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="{{ url_for('stocks.list_crypto') }}" class="btn btn-warning btn-sm">Se alle kryptovalutaer</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Currency Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-currency-exchange"></i> Valutakurser</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Valutapar</th>
                                                <th>Kurs</th>
                                                <th>Endring</th>
                                                <th>Sist oppdatert</th>
                                            </tr>
                                        </thead>
                                        <tbody id="currency-data">
                                            <tr><td colspan="4" class="text-center">Laster valutadata...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <h6>Populære valutapar</h6>
                                <ul class="list-unstyled">
                                    <li><strong>USD/NOK:</strong> <span id="usd-nok-rate">-</span></li>
                                    <li><strong>EUR/NOK:</strong> <span id="eur-nok-rate">-</span></li>
                                    <li><strong>GBP/NOK:</strong> <span id="gbp-nok-rate">-</span></li>
                                </ul>
                                <a href="{{ url_for('stocks.list_currency') }}" class="btn btn-info btn-sm">Se alle valutaer</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if not current_user.is_authenticated %}
<!-- Demo Section -->
<div class="demo-section py-5">
    <div class="container">
        <h2 class="text-center mb-5">Prøv Aksjeradar gratis</h2>
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="demo-content">
                    <p class="text-center mb-4">Se hvordan våre verktøy kan hjelpe deg med investeringsbeslutningene dine.</p>
                    
                    <!-- Demo Stock Table -->
                    <div class="demo-table-container">
                        <h6>Populære aksjer på Oslo Børs</h6>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Aksje</th>
                                        <th>Pris</th>
                                        <th>Endring</th>
                                        <th>Volum</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stock in demo_stocks|default([
                                        {'symbol': 'DNB', 'name': 'DNB Bank', 'price': '185.40', 'change': '+2.1', 'volume': '2.1M'},
                                        {'symbol': 'EQUI', 'name': 'Equinor', 'price': '312.50', 'change': '+1.8', 'volume': '1.8M'},
                                        {'symbol': 'TEL', 'name': 'Telenor', 'price': '145.20', 'change': '-0.5', 'volume': '0.9M'},
                                        {'symbol': 'NHY', 'name': 'Norsk Hydro', 'price': '78.90', 'change': '+3.2', 'volume': '1.5M'}
                                    ]) %}
                                    <tr>
                                        <td>
                                            <strong>{{ stock.symbol }}</strong><br>
                                            <small class="text-muted">{{ stock.name }}</small>
                                        </td>
                                        <td>{{ stock.price }} NOK</td>
                                        <td>
                                            <span class="badge {% if stock.change.startswith('+') %}badge-success{% else %}badge-danger{% endif %}">
                                                {{ stock.change }}%
                                            </span>
                                        </td>
                                        <td>{{ stock.volume }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Only show pricing CTA for non-premium users -->
{% if not current_user.is_authenticated or not current_user.has_active_subscription() %}
<div class="cta-section py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="mb-4">Få tilgang til Norges mest avanserte aksjeplattform</h2>
                <p class="lead mb-4">Prøv gratis i dag og få tilgang til profesjonelle analyseverktøy</p>
                <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                    <a href="{{ url_for('pricing.index') }}" class="btn btn-primary btn-lg px-4 gap-3">Se våre planer</a>
                    <a href="{{ url_for('main.register') }}" class="btn btn-outline-secondary btn-lg px-4">Prøv gratis</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="cta-section py-5">
    <div class="container text-center">
        {% if current_user.is_authenticated %}
            <h2>Klar for å analysere?</h2>
            <p class="lead">Utforsk alle våre verktøy for å maksimere dine investeringer</p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="{{ url_for('main.financial_dashboard') }}" class="btn btn-primary btn-lg">
                    <i class="bi bi-speedometer2"></i> Gå til Dashboard
                </a>
                <a href="{{ url_for('analysis.index') }}" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-graph-up"></i> Start Analyse
                </a>
            </div>
        {% else %}
            <h2>Klar for å starte?</h2>
            <p class="lead">Bli med tusenvis av investorer som allerede bruker Aksjeradar</p>
            <a href="{{ url_for('main.register') }}" class="btn btn-primary btn-lg">Start gratis i dag</a>
        {% endif %}
    </div>
</div>

<style>
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 100px 0;
}

.hero-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
}

.hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    opacity: 0.9;
}

.hero-buttons .btn {
    margin: 0 10px 10px 0;
}

.market-card {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
    color: #333; /* Ensure dark text on white background */
}

.market-data .price {
    font-size: 1.5rem;
    font-weight: 600;
    display: block;
}

.change.positive {
    color: #28a745;
}

.change.negative {
    color: #dc3545;
}

.feature-card {
    text-align: center;
    padding: 2rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    height: 100%;
    color: #333; /* Ensure dark text on white background */
}

.feature-icon {
    font-size: 3rem;
    color: #667eea;
    margin-bottom: 1rem;
}

.demo-table-container {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    color: #333; /* Ensure dark text on white background */
}

.pricing-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    padding: 2rem;
    text-align: center;
    height: 100%;
    color: #333; /* Ensure dark text on white background */
}

.pricing-card.featured {
    border: 3px solid #667eea;
    transform: scale(1.05);
}

.pricing-header .price {
    font-size: 2.5rem;
    font-weight: 700;
    color: #667eea;
}

.pricing-header .price span {
    font-size: 1rem;
    color: #6c757d;
}

.pricing-features {
    list-style: none;
    padding: 0;
    margin: 2rem 0;
}

.pricing-features li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.cta-section {
    background: #667eea;
    color: white;
}

@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .pricing-card.featured {
        transform: none;
    }
}
</style>
{% endblock %}

{% block extra_css %}
<style>
/* Phase 3: Enhanced Mobile Responsiveness & Modern Design */

/* Dashboard Container Improvements */
.dashboard-container {
    padding: 0 15px;
}

/* Welcome Header Styling */
.welcome-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 2rem;
    border-radius: 15px;
    border: 1px solid #dee2e6;
    margin-bottom: 1rem;
}

.welcome-content h1 {
    color: #2c3e50;
    font-weight: 700;
}

.premium-badge .badge {
    font-size: 0.875rem;
    box-shadow: 0 2px 10px rgba(40, 167, 69, 0.2);
}

/* Quick Stats Mobile Cards */
.quick-stats-mobile {
    margin: 0 -15px;
    padding: 0 15px;
}

.stats-scroll {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.stats-scroll::-webkit-scrollbar {
    display: none;
}

.stat-card-mini {
    min-width: 100px;
}

.stat-card-mini .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.stat-card-mini .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1) !important;
}

/* Enhanced Card Styling */
.card {
    border-radius: 15px;
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
}

/* Gradient Headers */
.bg-gradient-primary {
    background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%) !important;
}

.bg-gradient-success {
    background: linear-gradient(135deg, #198754 0%, #157347 100%) !important;
}

.bg-gradient-warning {
    background: linear-gradient(135deg, #ffc107 0%, #e6ac00 100%) !important;
}

.bg-gradient-info {
    background: linear-gradient(135deg, #0dcaf0 0%, #0bb5d6 100%) !important;
}

/* Enhanced Table Styling */
.table-hover tbody tr:hover {
    background-color: rgba(13, 110, 253, 0.05);
    transform: scale(1.01);
    transition: all 0.2s ease;
}

.table thead th {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    color: #495057;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.875rem;
    letter-spacing: 0.5px;
}

/* Mobile Stock Cards */
.mobile-stocks-container {
    background: #f8f9fa;
    border-radius: 10px;
}

.stock-card {
    border: 1px solid #e9ecef;
    transition: all 0.2s ease;
    background: white !important;
}

.stock-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-color: #0d6efd;
}

/* Enhanced Buttons */
.btn {
    border-radius: 25px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    padding: 0.5rem 1.5rem;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn-primary {
    background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
}

.btn-outline-primary {
    border: 2px solid #0d6efd;
    color: #0d6efd;
    background: transparent;
}

.btn-outline-primary:hover {
    background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
    border-color: #0d6efd;
}

/* Hero Section Improvements */
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 5rem 0;
    position: relative;
    overflow: hidden;
}

.hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.1;
}

.hero-title {
    font-size: 3.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
}

.hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    opacity: 0.9;
    position: relative;
    z-index: 1;
}

/* Market Cards Enhanced */
.market-card {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    text-align: center;
    color: #333;
    border: 1px solid #f1f3f5;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.market-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.market-card:hover::before {
    transform: scaleX(1);
}

.market-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
}

.market-data {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 1rem;
}

.market-data .price {
    font-size: 1.8rem;
    font-weight: 700;
    color: #333;
    margin-right: 1rem;
}

.change.positive {
    color: #28a745;
    font-weight: 600;
}

.change.negative {
    color: #dc3545;
    font-weight: 600;
}

/* Feature Cards Enhanced */
.feature-card {
    text-align: center;
    padding: 3rem 2rem;
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    height: 100%;
    color: #333;
    border: 1px solid #f1f3f5;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.feature-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.feature-card:hover::before {
    transform: scaleX(1);
}

.feature-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 50px rgba(0,0,0,0.15);
}

.feature-icon {
    font-size: 3.5rem;
    color: #667eea;
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
}

.feature-card:hover .feature-icon {
    transform: scale(1.1);
    color: #764ba2;
}

/* Demo Table Enhanced */
.demo-table-container {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    color: #333;
    border: 1px solid #f1f3f5;
}

/* CTA Section Enhanced */
.cta-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    position: relative;
    overflow: hidden;
}

.cta-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
}

/* Mobile Responsive Enhancements */
@media (max-width: 768px) {
    .dashboard-container {
        padding: 0 10px;
    }
    
    .welcome-header {
        padding: 1.5rem;
        margin: 0 -10px 1rem;
        border-radius: 0;
    }
    
    .welcome-content h1 {
        font-size: 1.75rem;
    }
    
    .hero-title {
        font-size: 2.5rem;
    }
    
    .hero-section {
        padding: 3rem 0;
    }
    
    .feature-card {
        padding: 2rem 1.5rem;
        margin-bottom: 1rem;
    }
    
    .feature-icon {
        font-size: 2.5rem;
    }
    
    .market-card {
        margin-bottom: 1rem;
    }
    
    .market-data .price {
        font-size: 1.5rem;
    }
    
    .card {
        margin-bottom: 1rem;
    }
    
    .table-responsive {
        font-size: 0.875rem;
    }
    
    .btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }
}

@media (max-width: 576px) {
    .welcome-content h1 {
        font-size: 1.5rem;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .market-data {
        flex-direction: column;
        text-align: center;
    }
    
    .market-data .price {
        margin-right: 0;
        margin-bottom: 0.5rem;
    }
    
    .feature-card {
        padding: 1.5rem 1rem;
    }
    
    .premium-badge {
        text-align: center;
        margin-top: 1rem;
    }
}

/* Loading States */
.loading-shimmer {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* Smooth Animations */
* {
    scroll-behavior: smooth;
}

/* Enhanced Shadows */
.shadow-custom {
    box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important;
}

/* Improved Typography */
h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    letter-spacing: -0.025em;
}

.text-muted {
    color: #6c757d !important;
    font-weight: 400;
}

/* Enhanced Focus States */
.btn:focus,
.form-control:focus {
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    outline: none;
}
</style>
{% endblock %}
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
    color: #333;
}

.market-data {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 1rem;
}

.market-data .price {
    font-size: 1.5rem;
    font-weight: 700;
    color: #333;
    margin-right: 1rem;
}

.change.positive {
    color: #28a745;
}

.change.negative {
    color: #dc3545;
}

.feature-card {
    text-align: center;
    padding: 2rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    height: 100%;
    color: #333;
}

.feature-icon {
    font-size: 3rem;
    color: #667eea;
    margin-bottom: 1rem;
}

.demo-table-container {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    color: #333;
}

.pricing-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    padding: 2rem;
    text-align: center;
    height: 100%;
    color: #333;
}

.pricing-card.featured {
    border: 3px solid #667eea;
    transform: scale(1.05);
}

.pricing-header .price {
    font-size: 2.5rem;
    font-weight: 700;
    color: #667eea;
}

.pricing-header .price span {
    font-size: 1rem;
    color: #6c757d;
}

.pricing-features {
    list-style: none;
    padding: 0;
    margin: 2rem 0;
}

.pricing-features li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.cta-section {
    background: #667eea;
    color: white;
}

@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .pricing-card.featured {
        transform: none;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Load market data for premium users
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is authenticated and premium (we can tell by presence of market tables)
    if (document.getElementById('oslo-stocks')) {
        loadMarketData();
        // Refresh data every 5 minutes
        setInterval(loadMarketData, 300000);
    }
});

function loadMarketData() {
    // Load Oslo Børs data
    fetch('/api/stocks/oslo/top')
        .then(response => response.json())
        .then(data => {
            const osloTable = document.getElementById('oslo-stocks');
            if (data.success && data.stocks) {
                osloTable.innerHTML = data.stocks.slice(0, 5).map(stock => `
                    <tr>
                        <td><strong>${stock.symbol}</strong><br><small class="text-muted">${stock.name || ''}</small></td>
                        <td>${stock.price ? stock.price.toFixed(2) : 'N/A'}</td>
                        <td class="${stock.change >= 0 ? 'text-success' : 'text-danger'}">
                            ${stock.change ? (stock.change >= 0 ? '+' : '') + stock.change.toFixed(2) : 'N/A'}
                        </td>
                        <td class="${stock.change_percent >= 0 ? 'text-success' : 'text-danger'}">
                            ${stock.change_percent ? (stock.change_percent >= 0 ? '+' : '') + stock.change_percent.toFixed(2) + '%' : 'N/A'}
                        </td>
                        <td>${stock.volume ? stock.volume.toLocaleString() : 'N/A'}</td>
                    </tr>
                `).join('');
            } else {
                osloTable.innerHTML = '<tr><td colspan="5" class="text-muted">Kunne ikke laste Oslo Børs data</td></tr>';
            }
        })
        .catch(error => {
            console.error('Error loading Oslo stocks:', error);
            document.getElementById('oslo-stocks').innerHTML = '<tr><td colspan="5" class="text-danger">Feil ved lasting av data</td></tr>';
        });

    // Load Global stocks data
    fetch('/api/stocks/global/top')
        .then(response => response.json())
        .then(data => {
            const globalTable = document.getElementById('global-stocks');
            if (data.success && data.stocks) {
                globalTable.innerHTML = data.stocks.slice(0, 5).map(stock => `
                    <tr>
                        <td><strong>${stock.symbol}</strong></td>
                        <td>$${stock.price ? stock.price.toFixed(2) : 'N/A'}</td>
                        <td class="${stock.change >= 0 ? 'text-success' : 'text-danger'}">
                            ${stock.change_percent ? (stock.change_percent >= 0 ? '+' : '') + stock.change_percent.toFixed(2) + '%' : 'N/A'}
                        </td>
                    </tr>
                `).join('');
            } else {
                globalTable.innerHTML = '<tr><td colspan="3" class="text-muted">Ingen global data</td></tr>';
            }
        })
        .catch(error => {
            console.error('Error loading global stocks:', error);
            document.getElementById('global-stocks').innerHTML = '<tr><td colspan="3" class="text-danger">Feil ved lasting</td></tr>';
        });

    // Load Crypto data
    fetch('/api/stocks/crypto/top')
        .then(response => response.json())
        .then(data => {
            const cryptoTable = document.getElementById('crypto-data');
            if (data.success && data.cryptocurrencies) {
                cryptoTable.innerHTML = data.cryptocurrencies.slice(0, 5).map(crypto => `
                    <tr>
                        <td><strong>${crypto.symbol}</strong></td>
                        <td>$${crypto.price ? crypto.price.toFixed(2) : 'N/A'}</td>
                        <td class="${crypto.change_24h >= 0 ? 'text-success' : 'text-danger'}">
                            ${crypto.change_24h ? (crypto.change_24h >= 0 ? '+' : '') + crypto.change_24h.toFixed(2) + '%' : 'N/A'}
                        </td>
                    </tr>
                `).join('');
            } else {
                cryptoTable.innerHTML = '<tr><td colspan="3" class="text-muted">Ingen krypto data</td></tr>';
            }
        })
        .catch(error => {
            console.error('Error loading crypto data:', error);
            document.getElementById('crypto-data').innerHTML = '<tr><td colspan="3" class="text-danger">Feil ved lasting</td></tr>';
        });

    // Load Currency data
    fetch('/api/stocks/currency/rates')
        .then(response => response.json())
        .then(data => {
            const currencyTable = document.getElementById('currency-data');
            if (data.success && data.rates) {
                currencyTable.innerHTML = data.rates.slice(0, 4).map(rate => `
                    <tr>
                        <td><strong>${rate.pair}</strong></td>
                        <td>${rate.rate ? rate.rate.toFixed(4) : 'N/A'}</td>
                        <td class="${rate.change >= 0 ? 'text-success' : 'text-danger'}">
                            ${rate.change ? (rate.change >= 0 ? '+' : '') + rate.change.toFixed(4) : 'N/A'}
                        </td>
                        <td>${rate.updated || 'N/A'}</td>
                    </tr>
                `).join('');
                
                // Update popular currency pairs
                data.rates.forEach(rate => {
                    if (rate.pair === 'USD/NOK') document.getElementById('usd-nok-rate').textContent = rate.rate ? rate.rate.toFixed(4) : 'N/A';
                    if (rate.pair === 'EUR/NOK') document.getElementById('eur-nok-rate').textContent = rate.rate ? rate.rate.toFixed(4) : 'N/A';
                    if (rate.pair === 'GBP/NOK') document.getElementById('gbp-nok-rate').textContent = rate.rate ? rate.rate.toFixed(4) : 'N/A';
                });
            } else {
                currencyTable.innerHTML = '<tr><td colspan="4" class="text-muted">Ingen valutadata</td></tr>';
            }
        })
        .catch(error => {
            console.error('Error loading currency data:', error);
            document.getElementById('currency-data').innerHTML = '<tr><td colspan="4" class="text-danger">Feil ved lasting</td></tr>';
        });
}
</script>
{% endblock %}
